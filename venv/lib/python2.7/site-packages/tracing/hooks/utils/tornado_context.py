#!/usr/bin/env python
# coding: utf-8


def get_data_from_request(request):
    """
    Extracts the data required for 'sentry.interfaces.Http' from the
    current request being handled by the request handler

    :param return: A dictionary.
    """
    return {
        'request': {
            'url': request.full_url(),
            'method': request.method,
            'data': request.body,
            'query_string': request.query,
            'cookies': request.headers.get('Cookie', None),
            'headers': dict(request.headers),
        }
    }


def get_user_info(handler):
    try:
        user = handler.get_current_user()
    except Exception:
        return {}
    return {
        'user': {
            'is_authenticated': True if user else False
        }
    }


def get_context(handler):
    data = {}

    # Update request data
    data.update(get_data_from_request(handler.request))

    # update user data
    data.update(get_user_info(handler))
    return data

