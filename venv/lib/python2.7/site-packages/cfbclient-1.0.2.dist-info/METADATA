Metadata-Version: 2.1
Name: cfbclient
Version: 1.0.2
Summary: client of config bao
Home-page: http://git.in.zhihu.com/infrastructure/cfbclient
Author: Young King
Author-email: y@zhihu.com
License: Private
Keywords: cfbclient
Platform: UNKNOWN
Classifier: Development Status :: 2 - Pre-Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: Private License
Classifier: Natural Language :: English
Classifier: Programming Language :: Python :: 2
Classifier: Programming Language :: Python :: 2.7
Requires-Dist: requests (<3.0,>=2.5.0)
Requires-Dist: diplomat (<2.0,>=1.3.0)
Requires-Dist: pstatsd (>=1.1.4)
Requires-Dist: tlcache (>=0.2.1)

===============================
cfbclient
===============================
配置宝的新客户端。

* Documentation: http://cfbclient.zhdocs.io/ .

Usage
---------

1.  访问配置

    >>> from cfbclient import connect
    >>> config = connect('zhihu-api')

    # 访问 like dict （推荐）

    >>> print config['kernel']
    ... 2000
    >>> print config['mysql']['default']
    ... mysql://localhost/test

    # 按属性访问（不推荐）

    >>> print config.kernel
    ... {...}
    >>> print config.kernel.port
    ... 2000
    >>> print config.kernel['port']
    ... 2000

    # 用函数访问

    >>> print config.get('kernel')

2. 本地开发模式

    新版的 cfbclient 开始支持本地的配置文件，你需要把所有依赖的配置已 `config_name` 作为 key，写在一个 json 文件中，格式很类似 boring 的 `cfb.json`:

    >>> {
    >>>     'service1': {
    >>>         configs ....
    >>>     },
    >>>     'service2': {
    >>>         configs ....
    >>>     }
    >>> }

最后通过环境变量指定该配置文件的位置：

    >>> export CFB_LOCAL=tests/cfb.json


FAQ
--------------------
1.  遇到了 requests.exceptions.ConnectionError: ('Connection aborted.', error(111, 'Connection refused')) 是怎么回事?

    你的本地没有启动 consul agent, 我们可以使用远程的 consul agent，运行一下命令就可以正常使用：

    >>> export SERVICE_DISCOVERY_URI=consul://discovery.dev.zhihu.com:8500

    如果需要安装 Consul Agent，可以参考: http://diplomat.zhdocs.io/en/latest/installation.html






History
-------

1.0.2 (2017-08-30)
+++++++++++++++++++
* 使用标准的 ZAE 环境变量

1.0.1 (2017-07-03)
+++++++++++++++++++
* 更明显的错误提示

1.0 (2017-06-23)
+++++++++++++++++++
* 默认访问 v2 的 api, 通过环境变量 CFB_VERSION 可切回 v1

1.0a0 (2017-06-13)
+++++++++++++++++++
* 支持访问多 profile
* 支持访问 cfbservice  v2 的 api, 通过环境变量 CFB_VERSION 启用

0.5.2 (2016-09-07)
+++++++++++++++++++
* 解决 key 中包含 `.` 不能被识别的问题

0.5.1 (2016-07-15)
+++++++++++++++++++

* 发布 0.5.1 正式版

0.5.1a1 (2016-06-12)
++++++++++++++++++++
* 解决 T55668 的问题，即支持链式的属性调用

0.5.1a0 (2016-06-07)
++++++++++++++++++++
* 使用 tlcache 代替内置的文件缓存
* 对不存在的配置不再容错
* 使用 requests 内置的重试机制

0.5.0 (2016-06-06)
+++++++++++++++++++
* use lock limit concurrency
* cancel lazy strategy

0.4.3 (2016-05-09)
+++++++++++++++++++
* add statsd metrics

0.4.2 (2016-05-06)
++++++++++++++++++
* fix  recursion  when occus AttributeError

0.4.1 (2016-04-22)
++++++++++++++++++
* add retry

0.4.0 (2016-04-06)
++++++++++++++++++
* Support local config

0.3.7 (2015-11-12)
+++++++++++++++++++
* Upgrade diplomat to 1.0.0a0

0.3.6 (2015-06-10)
+++++++++++++++++++
* Use random stragey instead of roundrobin

0.3.5 (2015-06-09)
++++++++++++++++++
* When consul is not started, raise RuntimeError exception

0.3.4 (2015-06-08)
++++++++++++++++++++
* Use user uid as part of filecache key, now all users can use cfbclient
* Use new diplomat client (0.2.0)

0.3.3 (2015-06-04)
+++++++++++++++++++
* Add Docker support
* Let other user can use cfbclient, though it will warning.

0.3.2 (2015-06-02)
+++++++++++++++++++
* Add lazy cache property to reduce connections

0.3.1 (2015-06-02)
+++++++++++++++++++
* Read from local cache when server is timeout

0.3.0 (2015-06-01)
+++++++++++++++++++
* Add per app config

0.2.2 (2015-06-01)
+++++++++++++++++++
* Failover to local file cache when server is down or exception

0.2.0 (2015-05-29)
+++++++++++++++++++
* New client of cfbservice instead of cfbagent


0.1.0 (2014-06-19)
++++++++++++++++++

* First release on PyPI.


